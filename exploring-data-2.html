<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>R Programming for Research</title>
  <meta name="description" content="This is a bookdown version of the course notes for R Programming for Research, Colorado State University, Fall 2016.">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="R Programming for Research" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a bookdown version of the course notes for R Programming for Research, Colorado State University, Fall 2016." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="R Programming for Research" />
  
  <meta name="twitter:description" content="This is a bookdown version of the course notes for R Programming for Research, Colorado State University, Fall 2016." />
  

<meta name="author" content="Brooke Anderson and Rachel Severson">


<meta name="date" content="2017-09-11">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="entering-and-cleaning-data-2.html">
<link rel="next" href="appendix-a-vocabulary.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R Programming for Research</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Online course book, ERHS 535</a></li>
<li class="chapter" data-level="" data-path="course-information.html"><a href="course-information.html"><i class="fa fa-check"></i>Course information</a><ul>
<li class="chapter" data-level="0.1" data-path="course-information.html"><a href="course-information.html#course-overview"><i class="fa fa-check"></i><b>0.1</b> Course overview</a></li>
<li class="chapter" data-level="0.2" data-path="course-information.html"><a href="course-information.html#time-and-place"><i class="fa fa-check"></i><b>0.2</b> Time and place</a></li>
<li class="chapter" data-level="0.3" data-path="course-information.html"><a href="course-information.html#detailed-schedule"><i class="fa fa-check"></i><b>0.3</b> Detailed schedule</a></li>
<li class="chapter" data-level="0.4" data-path="course-information.html"><a href="course-information.html#grading"><i class="fa fa-check"></i><b>0.4</b> Grading</a><ul>
<li class="chapter" data-level="0.4.1" data-path="course-information.html"><a href="course-information.html#attendance-and-class-participation"><i class="fa fa-check"></i><b>0.4.1</b> Attendance and class participation</a></li>
<li class="chapter" data-level="0.4.2" data-path="course-information.html"><a href="course-information.html#weekly-in-course-group-exercises"><i class="fa fa-check"></i><b>0.4.2</b> Weekly in-course group exercises</a></li>
<li class="chapter" data-level="0.4.3" data-path="course-information.html"><a href="course-information.html#in-class-quizzes"><i class="fa fa-check"></i><b>0.4.3</b> In-class quizzes</a></li>
<li class="chapter" data-level="0.4.4" data-path="course-information.html"><a href="course-information.html#homework"><i class="fa fa-check"></i><b>0.4.4</b> Homework</a></li>
<li class="chapter" data-level="0.4.5" data-path="course-information.html"><a href="course-information.html#final-group-project"><i class="fa fa-check"></i><b>0.4.5</b> Final group project</a></li>
</ul></li>
<li class="chapter" data-level="0.5" data-path="course-information.html"><a href="course-information.html#course-set-up"><i class="fa fa-check"></i><b>0.5</b> Course set-up</a></li>
<li class="chapter" data-level="0.6" data-path="course-information.html"><a href="course-information.html#coursebook"><i class="fa fa-check"></i><b>0.6</b> Coursebook</a><ul>
<li class="chapter" data-level="0.6.1" data-path="course-information.html"><a href="course-information.html#other-helpful-books-not-required"><i class="fa fa-check"></i><b>0.6.1</b> Other helpful books (not required)</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Part I: Preliminaries</b></span></li>
<li class="chapter" data-level="1" data-path="r-preliminaries.html"><a href="r-preliminaries.html"><i class="fa fa-check"></i><b>1</b> R Preliminaries</a><ul>
<li class="chapter" data-level="1.1" data-path="r-preliminaries.html"><a href="r-preliminaries.html#r-and-r-studio"><i class="fa fa-check"></i><b>1.1</b> R and R Studio</a><ul>
<li class="chapter" data-level="1.1.1" data-path="r-preliminaries.html"><a href="r-preliminaries.html#what-is-r"><i class="fa fa-check"></i><b>1.1.1</b> What is R?</a></li>
<li class="chapter" data-level="1.1.2" data-path="r-preliminaries.html"><a href="r-preliminaries.html#open-source-software"><i class="fa fa-check"></i><b>1.1.2</b> Open-source software</a></li>
<li class="chapter" data-level="1.1.3" data-path="r-preliminaries.html"><a href="r-preliminaries.html#what-is-rstudio"><i class="fa fa-check"></i><b>1.1.3</b> What is RStudio?</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="r-preliminaries.html"><a href="r-preliminaries.html#the-package-system"><i class="fa fa-check"></i><b>1.2</b> The “package” system</a><ul>
<li class="chapter" data-level="1.2.1" data-path="r-preliminaries.html"><a href="r-preliminaries.html#r-packages"><i class="fa fa-check"></i><b>1.2.1</b> R packages</a></li>
<li class="chapter" data-level="1.2.2" data-path="r-preliminaries.html"><a href="r-preliminaries.html#installing-from-cran"><i class="fa fa-check"></i><b>1.2.2</b> Installing from CRAN</a></li>
<li class="chapter" data-level="1.2.3" data-path="r-preliminaries.html"><a href="r-preliminaries.html#loading-an-installed-package"><i class="fa fa-check"></i><b>1.2.3</b> Loading an installed package</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="r-preliminaries.html"><a href="r-preliminaries.html#basic-code-conventions-of-r"><i class="fa fa-check"></i><b>1.3</b> Basic code conventions of R</a><ul>
<li class="chapter" data-level="1.3.1" data-path="r-preliminaries.html"><a href="r-preliminaries.html#rs-mvp-the-gets-arrow"><i class="fa fa-check"></i><b>1.3.1</b> R’s MVP: The <em>gets arrow</em></a></li>
<li class="chapter" data-level="1.3.2" data-path="r-preliminaries.html"><a href="r-preliminaries.html#assignment-operator-wars---vs."><i class="fa fa-check"></i><b>1.3.2</b> Assignment operator wars: <code>&lt;-</code> vs. <code>=</code></a></li>
<li class="chapter" data-level="1.3.3" data-path="r-preliminaries.html"><a href="r-preliminaries.html#naming-objects"><i class="fa fa-check"></i><b>1.3.3</b> Naming objects</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="r-preliminaries.html"><a href="r-preliminaries.html#rs-most-basic-object-types"><i class="fa fa-check"></i><b>1.4</b> R’s most basic object types</a><ul>
<li class="chapter" data-level="1.4.1" data-path="r-preliminaries.html"><a href="r-preliminaries.html#vectors"><i class="fa fa-check"></i><b>1.4.1</b> Vectors</a></li>
<li class="chapter" data-level="1.4.2" data-path="r-preliminaries.html"><a href="r-preliminaries.html#dataframes"><i class="fa fa-check"></i><b>1.4.2</b> Dataframes</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="r-preliminaries.html"><a href="r-preliminaries.html#using-r-functions"><i class="fa fa-check"></i><b>1.5</b> Using R functions</a><ul>
<li class="chapter" data-level="1.5.1" data-path="r-preliminaries.html"><a href="r-preliminaries.html#function-structure"><i class="fa fa-check"></i><b>1.5.1</b> Function structure</a></li>
<li class="chapter" data-level="1.5.2" data-path="r-preliminaries.html"><a href="r-preliminaries.html#function-help-files"><i class="fa fa-check"></i><b>1.5.2</b> Function help files</a></li>
<li class="chapter" data-level="1.5.3" data-path="r-preliminaries.html"><a href="r-preliminaries.html#function-parameters"><i class="fa fa-check"></i><b>1.5.3</b> Function parameters</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="r-preliminaries.html"><a href="r-preliminaries.html#r-scripts"><i class="fa fa-check"></i><b>1.6</b> R scripts</a><ul>
<li class="chapter" data-level="1.6.1" data-path="r-preliminaries.html"><a href="r-preliminaries.html#commenting-code"><i class="fa fa-check"></i><b>1.6.1</b> Commenting code</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="r-preliminaries.html"><a href="r-preliminaries.html#in-course-exercise"><i class="fa fa-check"></i><b>1.7</b> In-course Exercise</a><ul>
<li class="chapter" data-level="1.7.1" data-path="r-preliminaries.html"><a href="r-preliminaries.html#about-the-dataset"><i class="fa fa-check"></i><b>1.7.1</b> About the dataset</a></li>
<li class="chapter" data-level="1.7.2" data-path="r-preliminaries.html"><a href="r-preliminaries.html#manually-creating-vectors-and-a-dataframe"><i class="fa fa-check"></i><b>1.7.2</b> Manually creating vectors and a dataframe</a></li>
<li class="chapter" data-level="1.7.3" data-path="r-preliminaries.html"><a href="r-preliminaries.html#installing-and-using-a-package"><i class="fa fa-check"></i><b>1.7.3</b> Installing and using a package</a></li>
<li class="chapter" data-level="1.7.4" data-path="r-preliminaries.html"><a href="r-preliminaries.html#getting-the-data-onto-your-computer"><i class="fa fa-check"></i><b>1.7.4</b> Getting the data onto your computer</a></li>
<li class="chapter" data-level="1.7.5" data-path="r-preliminaries.html"><a href="r-preliminaries.html#getting-the-data-into-r"><i class="fa fa-check"></i><b>1.7.5</b> Getting the data into R</a></li>
<li class="chapter" data-level="1.7.6" data-path="r-preliminaries.html"><a href="r-preliminaries.html#checking-out-the-data"><i class="fa fa-check"></i><b>1.7.6</b> Checking out the data</a></li>
<li class="chapter" data-level="1.7.7" data-path="r-preliminaries.html"><a href="r-preliminaries.html#using-the-data-to-answer-questions"><i class="fa fa-check"></i><b>1.7.7</b> Using the data to answer questions</a></li>
<li class="chapter" data-level="1.7.8" data-path="r-preliminaries.html"><a href="r-preliminaries.html#writing-your-code-as-an-r-script"><i class="fa fa-check"></i><b>1.7.8</b> Writing your code as an R script</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Part II: Basics</b></span></li>
<li class="chapter" data-level="2" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html"><i class="fa fa-check"></i><b>2</b> Entering and cleaning data #1</a><ul>
<li class="chapter" data-level="2.1" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#directories-and-pathnames"><i class="fa fa-check"></i><b>2.1</b> Directories and pathnames</a><ul>
<li class="chapter" data-level="2.1.1" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#directory-structure"><i class="fa fa-check"></i><b>2.1.1</b> Directory structure</a></li>
<li class="chapter" data-level="2.1.2" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#working-directory"><i class="fa fa-check"></i><b>2.1.2</b> Working directory</a></li>
<li class="chapter" data-level="2.1.3" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#file-and-directory-pathnames"><i class="fa fa-check"></i><b>2.1.3</b> File and directory pathnames</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#diversion-paste"><i class="fa fa-check"></i><b>2.2</b> Diversion: <code>paste</code></a></li>
<li class="chapter" data-level="2.3" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#reading-data-into-r"><i class="fa fa-check"></i><b>2.3</b> Reading data into R</a><ul>
<li class="chapter" data-level="2.3.1" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#reading-local-flat-files"><i class="fa fa-check"></i><b>2.3.1</b> Reading local flat files</a></li>
<li class="chapter" data-level="2.3.2" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#the-read_-functions"><i class="fa fa-check"></i><b>2.3.2</b> The <code>read_*</code> functions</a></li>
<li class="chapter" data-level="2.3.3" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#reading-online-flat-files"><i class="fa fa-check"></i><b>2.3.3</b> Reading online flat files</a></li>
<li class="chapter" data-level="2.3.4" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#saving-and-loading-r-objects"><i class="fa fa-check"></i><b>2.3.4</b> Saving and loading R objects</a></li>
<li class="chapter" data-level="2.3.5" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#reading-other-file-types"><i class="fa fa-check"></i><b>2.3.5</b> Reading other file types</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#data-cleaning"><i class="fa fa-check"></i><b>2.4</b> Data cleaning</a><ul>
<li class="chapter" data-level="2.4.1" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#renaming-columns"><i class="fa fa-check"></i><b>2.4.1</b> Renaming columns</a></li>
<li class="chapter" data-level="2.4.2" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#selecting-columns"><i class="fa fa-check"></i><b>2.4.2</b> Selecting columns</a></li>
<li class="chapter" data-level="2.4.3" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#filtering-to-certain-rows"><i class="fa fa-check"></i><b>2.4.3</b> Filtering to certain rows</a></li>
<li class="chapter" data-level="2.4.4" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#add-or-change-columns"><i class="fa fa-check"></i><b>2.4.4</b> Add or change columns</a></li>
<li class="chapter" data-level="2.4.5" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#piping"><i class="fa fa-check"></i><b>2.4.5</b> Piping</a></li>
<li class="chapter" data-level="2.4.6" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#base-r-equivalents-to-dplyr-functions"><i class="fa fa-check"></i><b>2.4.6</b> Base R equivalents to <code>dplyr</code> functions</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#dates-in-r"><i class="fa fa-check"></i><b>2.5</b> Dates in R</a></li>
<li class="chapter" data-level="2.6" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#in-course-exercise-1"><i class="fa fa-check"></i><b>2.6</b> In-course Exercise</a><ul>
<li class="chapter" data-level="2.6.1" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#checking-out-directory-structures"><i class="fa fa-check"></i><b>2.6.1</b> Checking out directory structures</a></li>
<li class="chapter" data-level="2.6.2" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#using-relative-and-absolute-file-pathnames"><i class="fa fa-check"></i><b>2.6.2</b> Using relative and absolute file pathnames</a></li>
<li class="chapter" data-level="2.6.3" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#reading-in-different-types-of-files"><i class="fa fa-check"></i><b>2.6.3</b> Reading in different types of files</a></li>
<li class="chapter" data-level="2.6.4" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#cleaning-up-data-1"><i class="fa fa-check"></i><b>2.6.4</b> Cleaning up data #1</a></li>
<li class="chapter" data-level="2.6.5" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#cleaning-up-data-2"><i class="fa fa-check"></i><b>2.6.5</b> Cleaning up data #2</a></li>
<li class="chapter" data-level="2.6.6" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#piping-1"><i class="fa fa-check"></i><b>2.6.6</b> Piping</a></li>
<li class="chapter" data-level="2.6.7" data-path="entering-and-cleaning-data-1.html"><a href="entering-and-cleaning-data-1.html#a-taste-of-whats-to-come"><i class="fa fa-check"></i><b>2.6.7</b> A taste of what’s to come…</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="exploring-data-1.html"><a href="exploring-data-1.html"><i class="fa fa-check"></i><b>3</b> Exploring data #1</a><ul>
<li class="chapter" data-level="3.1" data-path="exploring-data-1.html"><a href="exploring-data-1.html#data-from-a-package"><i class="fa fa-check"></i><b>3.1</b> Data from a package</a></li>
<li class="chapter" data-level="3.2" data-path="exploring-data-1.html"><a href="exploring-data-1.html#plots-to-explore-data"><i class="fa fa-check"></i><b>3.2</b> Plots to explore data</a><ul>
<li class="chapter" data-level="3.2.1" data-path="exploring-data-1.html"><a href="exploring-data-1.html#initializing-a-ggplot-object"><i class="fa fa-check"></i><b>3.2.1</b> Initializing a ggplot object</a></li>
<li class="chapter" data-level="3.2.2" data-path="exploring-data-1.html"><a href="exploring-data-1.html#plot-aesthetics"><i class="fa fa-check"></i><b>3.2.2</b> Plot aesthetics</a></li>
<li class="chapter" data-level="3.2.3" data-path="exploring-data-1.html"><a href="exploring-data-1.html#adding-geoms"><i class="fa fa-check"></i><b>3.2.3</b> Adding geoms</a></li>
<li class="chapter" data-level="3.2.4" data-path="exploring-data-1.html"><a href="exploring-data-1.html#constant-aesthetics"><i class="fa fa-check"></i><b>3.2.4</b> Constant aesthetics</a></li>
<li class="chapter" data-level="3.2.5" data-path="exploring-data-1.html"><a href="exploring-data-1.html#useful-plot-additions"><i class="fa fa-check"></i><b>3.2.5</b> Useful plot additions</a></li>
<li class="chapter" data-level="3.2.6" data-path="exploring-data-1.html"><a href="exploring-data-1.html#example-dataset"><i class="fa fa-check"></i><b>3.2.6</b> Example dataset</a></li>
<li class="chapter" data-level="3.2.7" data-path="exploring-data-1.html"><a href="exploring-data-1.html#histograms"><i class="fa fa-check"></i><b>3.2.7</b> Histograms</a></li>
<li class="chapter" data-level="3.2.8" data-path="exploring-data-1.html"><a href="exploring-data-1.html#scatterplots"><i class="fa fa-check"></i><b>3.2.8</b> Scatterplots</a></li>
<li class="chapter" data-level="3.2.9" data-path="exploring-data-1.html"><a href="exploring-data-1.html#boxplots"><i class="fa fa-check"></i><b>3.2.9</b> Boxplots</a></li>
<li class="chapter" data-level="3.2.10" data-path="exploring-data-1.html"><a href="exploring-data-1.html#extensions-of-ggplot2"><i class="fa fa-check"></i><b>3.2.10</b> Extensions of <code>ggplot2</code></a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="exploring-data-1.html"><a href="exploring-data-1.html#simple-statistics-functions"><i class="fa fa-check"></i><b>3.3</b> Simple statistics functions</a><ul>
<li class="chapter" data-level="3.3.1" data-path="exploring-data-1.html"><a href="exploring-data-1.html#summary-statistics"><i class="fa fa-check"></i><b>3.3.1</b> Summary statistics</a></li>
<li class="chapter" data-level="3.3.2" data-path="exploring-data-1.html"><a href="exploring-data-1.html#summarize-function"><i class="fa fa-check"></i><b>3.3.2</b> <code>summarize</code> function</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="exploring-data-1.html"><a href="exploring-data-1.html#logical-vectors"><i class="fa fa-check"></i><b>3.4</b> Logical vectors</a></li>
<li class="chapter" data-level="3.5" data-path="exploring-data-1.html"><a href="exploring-data-1.html#regression-models"><i class="fa fa-check"></i><b>3.5</b> Regression models</a><ul>
<li class="chapter" data-level="3.5.1" data-path="exploring-data-1.html"><a href="exploring-data-1.html#formula-structure"><i class="fa fa-check"></i><b>3.5.1</b> Formula structure</a></li>
<li class="chapter" data-level="3.5.2" data-path="exploring-data-1.html"><a href="exploring-data-1.html#linear-models"><i class="fa fa-check"></i><b>3.5.2</b> Linear models</a></li>
<li class="chapter" data-level="3.5.3" data-path="exploring-data-1.html"><a href="exploring-data-1.html#generalized-linear-models-glms"><i class="fa fa-check"></i><b>3.5.3</b> Generalized linear models (GLMs)</a></li>
<li class="chapter" data-level="3.5.4" data-path="exploring-data-1.html"><a href="exploring-data-1.html#references-statistics-in-r"><i class="fa fa-check"></i><b>3.5.4</b> References– statistics in R</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="exploring-data-1.html"><a href="exploring-data-1.html#in-course-exercise-2"><i class="fa fa-check"></i><b>3.6</b> In-course exercise</a><ul>
<li class="chapter" data-level="3.6.1" data-path="exploring-data-1.html"><a href="exploring-data-1.html#loading-data-from-an-r-package"><i class="fa fa-check"></i><b>3.6.1</b> Loading data from an R package</a></li>
<li class="chapter" data-level="3.6.2" data-path="exploring-data-1.html"><a href="exploring-data-1.html#exploring-the-data-using-logical-statements"><i class="fa fa-check"></i><b>3.6.2</b> Exploring the data using logical statements</a></li>
<li class="chapter" data-level="3.6.3" data-path="exploring-data-1.html"><a href="exploring-data-1.html#exploring-the-data-using-simple-statistics-and-summarize"><i class="fa fa-check"></i><b>3.6.3</b> Exploring the data using simple statistics and <code>summarize</code></a></li>
<li class="chapter" data-level="3.6.4" data-path="exploring-data-1.html"><a href="exploring-data-1.html#exploring-the-data-using-basic-plots-1"><i class="fa fa-check"></i><b>3.6.4</b> Exploring the data using basic plots #1</a></li>
<li class="chapter" data-level="3.6.5" data-path="exploring-data-1.html"><a href="exploring-data-1.html#exploring-the-data-using-basic-plots-2"><i class="fa fa-check"></i><b>3.6.5</b> Exploring the data using basic plots #2</a></li>
<li class="chapter" data-level="3.6.6" data-path="exploring-data-1.html"><a href="exploring-data-1.html#exploring-the-data-using-basic-plots-3"><i class="fa fa-check"></i><b>3.6.6</b> Exploring the data using basic plots #3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html"><i class="fa fa-check"></i><b>4</b> Reporting data results #1</a><ul>
<li class="chapter" data-level="4.1" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#guidelines-for-good-plots"><i class="fa fa-check"></i><b>4.1</b> Guidelines for good plots</a></li>
<li class="chapter" data-level="4.2" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#high-data-density"><i class="fa fa-check"></i><b>4.2</b> High data density</a></li>
<li class="chapter" data-level="4.3" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#meaningful-labels"><i class="fa fa-check"></i><b>4.3</b> Meaningful labels</a></li>
<li class="chapter" data-level="4.4" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#references"><i class="fa fa-check"></i><b>4.4</b> References</a></li>
<li class="chapter" data-level="4.5" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#highlighting"><i class="fa fa-check"></i><b>4.5</b> Highlighting</a></li>
<li class="chapter" data-level="4.6" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#order"><i class="fa fa-check"></i><b>4.6</b> Order</a></li>
<li class="chapter" data-level="4.7" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#small-multiples"><i class="fa fa-check"></i><b>4.7</b> Small multiples</a></li>
<li class="chapter" data-level="4.8" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#advanced-customization"><i class="fa fa-check"></i><b>4.8</b> Advanced customization</a><ul>
<li class="chapter" data-level="4.8.1" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#scales"><i class="fa fa-check"></i><b>4.8.1</b> Scales</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#to-find-out-more"><i class="fa fa-check"></i><b>4.9</b> To find out more</a></li>
<li class="chapter" data-level="4.10" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#in-course-exercise-3"><i class="fa fa-check"></i><b>4.10</b> In-course exercise</a><ul>
<li class="chapter" data-level="4.10.1" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#designing-a-plot"><i class="fa fa-check"></i><b>4.10.1</b> Designing a plot</a></li>
<li class="chapter" data-level="4.10.2" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#basic-scatterplots-with-r-base-graphics-and-ggplot"><i class="fa fa-check"></i><b>4.10.2</b> Basic scatterplots with R base graphics and ggplot</a></li>
<li class="chapter" data-level="4.10.3" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#fancier-graphs"><i class="fa fa-check"></i><b>4.10.3</b> Fancier graphs</a></li>
<li class="chapter" data-level="4.10.4" data-path="reporting-data-results-1.html"><a href="reporting-data-results-1.html#data-visualization-cheatsheet"><i class="fa fa-check"></i><b>4.10.4</b> Data visualization cheatsheet</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html"><i class="fa fa-check"></i><b>5</b> Reproducible research #1</a><ul>
<li class="chapter" data-level="5.1" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#what-is-reproducible-research"><i class="fa fa-check"></i><b>5.1</b> What is reproducible research?</a></li>
<li class="chapter" data-level="5.2" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#markdown"><i class="fa fa-check"></i><b>5.2</b> Markdown</a></li>
<li class="chapter" data-level="5.3" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#literate-programming-in-r"><i class="fa fa-check"></i><b>5.3</b> Literate programming in R</a></li>
<li class="chapter" data-level="5.4" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#style-guidelines"><i class="fa fa-check"></i><b>5.4</b> Style guidelines</a><ul>
<li class="chapter" data-level="5.4.1" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#line-length"><i class="fa fa-check"></i><b>5.4.1</b> Line length</a></li>
<li class="chapter" data-level="5.4.2" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#spacing"><i class="fa fa-check"></i><b>5.4.2</b> Spacing</a></li>
<li class="chapter" data-level="5.4.3" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#semicolons"><i class="fa fa-check"></i><b>5.4.3</b> Semicolons</a></li>
<li class="chapter" data-level="5.4.4" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#commenting"><i class="fa fa-check"></i><b>5.4.4</b> Commenting</a></li>
<li class="chapter" data-level="5.4.5" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#indentation"><i class="fa fa-check"></i><b>5.4.5</b> Indentation</a></li>
<li class="chapter" data-level="5.4.6" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#code-grouping"><i class="fa fa-check"></i><b>5.4.6</b> Code grouping</a></li>
<li class="chapter" data-level="5.4.7" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#broader-guidelines"><i class="fa fa-check"></i><b>5.4.7</b> Broader guidelines</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#more-with-knitr"><i class="fa fa-check"></i><b>5.5</b> More with knitr</a><ul>
<li class="chapter" data-level="5.5.1" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#equations-in-knitr"><i class="fa fa-check"></i><b>5.5.1</b> Equations in <code>knitr</code></a></li>
<li class="chapter" data-level="5.5.2" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#figures-from-file"><i class="fa fa-check"></i><b>5.5.2</b> Figures from file</a></li>
<li class="chapter" data-level="5.5.3" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#saving-graphics-files"><i class="fa fa-check"></i><b>5.5.3</b> Saving graphics files</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#saving-graphics-files-1"><i class="fa fa-check"></i><b>5.6</b> Saving graphics files</a><ul>
<li class="chapter" data-level="5.6.1" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#tables-in-r-markdown"><i class="fa fa-check"></i><b>5.6.1</b> Tables in R Markdown</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#in-course-exercise-4"><i class="fa fa-check"></i><b>5.7</b> In-course exercise</a><ul>
<li class="chapter" data-level="5.7.1" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#creating-a-markdown-document"><i class="fa fa-check"></i><b>5.7.1</b> Creating a Markdown document</a></li>
<li class="chapter" data-level="5.7.2" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#adding-in-r-code"><i class="fa fa-check"></i><b>5.7.2</b> Adding in R code</a></li>
<li class="chapter" data-level="5.7.3" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#working-with-r-markdown-documents"><i class="fa fa-check"></i><b>5.7.3</b> Working with R Markdown documents</a></li>
<li class="chapter" data-level="5.7.4" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#r-style-guidelines"><i class="fa fa-check"></i><b>5.7.4</b> R style guidelines</a></li>
<li class="chapter" data-level="5.7.5" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#trying-out-knitr-with-your-own-data"><i class="fa fa-check"></i><b>5.7.5</b> Trying out <code>knitr</code> with your own data</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Part III: Intermediate</b></span></li>
<li class="chapter" data-level="6" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html"><i class="fa fa-check"></i><b>6</b> Entering and cleaning data #2</a><ul>
<li class="chapter" data-level="6.1" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#joining-datasets"><i class="fa fa-check"></i><b>6.1</b> Joining datasets</a></li>
<li class="chapter" data-level="6.2" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#tidy-data"><i class="fa fa-check"></i><b>6.2</b> Tidy data</a></li>
<li class="chapter" data-level="6.3" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#gathering"><i class="fa fa-check"></i><b>6.3</b> Gathering</a></li>
<li class="chapter" data-level="6.4" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#in-course-exercise-5"><i class="fa fa-check"></i><b>6.4</b> In-course exercise</a><ul>
<li class="chapter" data-level="6.4.1" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#designing-tidy-data"><i class="fa fa-check"></i><b>6.4.1</b> Designing tidy data</a></li>
<li class="chapter" data-level="6.4.2" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#easier-data-wrangling"><i class="fa fa-check"></i><b>6.4.2</b> Easier data wrangling</a></li>
<li class="chapter" data-level="6.4.3" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#more-extensive-data-wrangling"><i class="fa fa-check"></i><b>6.4.3</b> More extensive data wrangling</a></li>
<li class="chapter" data-level="6.4.4" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#tidying-vadeaths-data"><i class="fa fa-check"></i><b>6.4.4</b> Tidying <code>VADeaths</code> data</a></li>
<li class="chapter" data-level="6.4.5" data-path="entering-and-cleaning-data-2.html"><a href="entering-and-cleaning-data-2.html#exploring-fatality-analysis-reporting-system-fars-data"><i class="fa fa-check"></i><b>6.4.5</b> Exploring Fatality Analysis Reporting System (FARS) data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="exploring-data-2.html"><a href="exploring-data-2.html"><i class="fa fa-check"></i><b>7</b> Exploring data #2</a><ul>
<li class="chapter" data-level="7.1" data-path="exploring-data-2.html"><a href="exploring-data-2.html#parentheses"><i class="fa fa-check"></i><b>7.1</b> Parentheses</a></li>
<li class="chapter" data-level="7.2" data-path="exploring-data-2.html"><a href="exploring-data-2.html#loops"><i class="fa fa-check"></i><b>7.2</b> Loops</a></li>
<li class="chapter" data-level="7.3" data-path="exploring-data-2.html"><a href="exploring-data-2.html#other-control-structures"><i class="fa fa-check"></i><b>7.3</b> Other control structures</a><ul>
<li class="chapter" data-level="7.3.1" data-path="exploring-data-2.html"><a href="exploring-data-2.html#if-else-loops"><i class="fa fa-check"></i><b>7.3.1</b> if / else loops</a></li>
<li class="chapter" data-level="7.3.2" data-path="exploring-data-2.html"><a href="exploring-data-2.html#some-other-control-structures"><i class="fa fa-check"></i><b>7.3.2</b> Some other control structures</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="exploring-data-2.html"><a href="exploring-data-2.html#functions"><i class="fa fa-check"></i><b>7.4</b> Functions</a></li>
<li class="chapter" data-level="7.5" data-path="exploring-data-2.html"><a href="exploring-data-2.html#regular-expressions"><i class="fa fa-check"></i><b>7.5</b> Regular expressions</a></li>
<li class="chapter" data-level="7.6" data-path="exploring-data-2.html"><a href="exploring-data-2.html#in-course-exercise-6"><i class="fa fa-check"></i><b>7.6</b> In-course exercise</a><ul>
<li class="chapter" data-level="7.6.1" data-path="exploring-data-2.html"><a href="exploring-data-2.html#exploring-fatality-analysis-reporting-system-fars-data-1"><i class="fa fa-check"></i><b>7.6.1</b> Exploring Fatality Analysis Reporting System (FARS) data</a></li>
<li class="chapter" data-level="7.6.2" data-path="exploring-data-2.html"><a href="exploring-data-2.html#using-a-loop-to-create-state-specific-plots"><i class="fa fa-check"></i><b>7.6.2</b> Using a loop to create state-specific plots</a></li>
<li class="chapter" data-level="7.6.3" data-path="exploring-data-2.html"><a href="exploring-data-2.html#using-regression-models-to-explore-data"><i class="fa fa-check"></i><b>7.6.3</b> Using regression models to explore data</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
<li class="chapter" data-level="A" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html"><i class="fa fa-check"></i><b>A</b> Appendix A: Vocabulary</a><ul>
<li class="chapter" data-level="A.1" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html#quiz-1"><i class="fa fa-check"></i><b>A.1</b> Quiz 1</a></li>
<li class="chapter" data-level="A.2" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html#quiz-2"><i class="fa fa-check"></i><b>A.2</b> Quiz 2</a></li>
<li class="chapter" data-level="A.3" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html#quiz-3"><i class="fa fa-check"></i><b>A.3</b> Quiz 3</a></li>
<li class="chapter" data-level="A.4" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html#quiz-4"><i class="fa fa-check"></i><b>A.4</b> Quiz 4</a></li>
<li class="chapter" data-level="A.5" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html#quiz-5"><i class="fa fa-check"></i><b>A.5</b> Quiz 5</a></li>
<li class="chapter" data-level="A.6" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html#quiz-6"><i class="fa fa-check"></i><b>A.6</b> Quiz 6</a></li>
<li class="chapter" data-level="A.7" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html#quiz-7"><i class="fa fa-check"></i><b>A.7</b> Quiz 7</a></li>
<li class="chapter" data-level="A.8" data-path="appendix-a-vocabulary.html"><a href="appendix-a-vocabulary.html#quiz-8"><i class="fa fa-check"></i><b>A.8</b> Quiz 8</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html"><i class="fa fa-check"></i><b>B</b> Appendix B: Homework</a><ul>
<li class="chapter" data-level="B.1" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#homework-1"><i class="fa fa-check"></i><b>B.1</b> Homework #1</a><ul>
<li class="chapter" data-level="B.1.1" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#option-1"><i class="fa fa-check"></i><b>B.1.1</b> Option 1</a></li>
<li class="chapter" data-level="B.1.2" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#option-2"><i class="fa fa-check"></i><b>B.1.2</b> Option 2</a></li>
<li class="chapter" data-level="B.1.3" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#special-swirl-commands"><i class="fa fa-check"></i><b>B.1.3</b> Special swirl commands</a></li>
</ul></li>
<li class="chapter" data-level="B.2" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#homework-2"><i class="fa fa-check"></i><b>B.2</b> Homework #2</a></li>
<li class="chapter" data-level="B.3" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#homework-3"><i class="fa fa-check"></i><b>B.3</b> Homework #3</a></li>
<li class="chapter" data-level="B.4" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#homework-4"><i class="fa fa-check"></i><b>B.4</b> Homework #4</a></li>
<li class="chapter" data-level="B.5" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#homework-5"><i class="fa fa-check"></i><b>B.5</b> Homework #5</a></li>
<li class="chapter" data-level="B.6" data-path="appendix-b-homework.html"><a href="appendix-b-homework.html#homework-6"><i class="fa fa-check"></i><b>B.6</b> Homework #6</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-1.html"><a href="references-1.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Programming for Research</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exploring-data-2" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> Exploring data #2</h1>
<p><a href="https://github.com/geanders/RProgrammingForResearch/raw/master/slides/CourseNotes_Week7.pdf">Download</a> a pdf of the lecture slides covering this topic.</p>
<div id="parentheses" class="section level2">
<h2><span class="header-section-number">7.1</span> Parentheses</h2>
<p>If you put parentheses around an entire code statement, it will both run the code and print out the answer.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">study_months &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Jan&quot;</span>, <span class="st">&quot;Feb&quot;</span>, <span class="st">&quot;Mar&quot;</span>)
study_months</code></pre></div>
<pre><code>## [1] &quot;Jan&quot; &quot;Feb&quot; &quot;Mar&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(study_months &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Jan&quot;</span>, <span class="st">&quot;Feb&quot;</span>, <span class="st">&quot;Mar&quot;</span>))</code></pre></div>
<pre><code>## [1] &quot;Jan&quot; &quot;Feb&quot; &quot;Mar&quot;</code></pre>
</div>
<div id="loops" class="section level2">
<h2><span class="header-section-number">7.2</span> Loops</h2>
<p>Loops allow you to “walk through” and repeat the same code for different values of an index. For each run of the loop, R is told that, for <strong>some index</strong> in <strong>some vector</strong>, do <strong>some code</strong>. For example, the following loop specifies: For <code>i</code> in <code>1:3</code>, <code>print(i)</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)){
        <span class="kw">print</span>(i)
}</code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3</code></pre>
<p>Note that this code is equivalent to:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">i &lt;-<span class="st"> </span><span class="dv">1</span>
<span class="kw">print</span>(i)</code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">i &lt;-<span class="st"> </span><span class="dv">2</span>
<span class="kw">print</span>(i)</code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">i &lt;-<span class="st"> </span><span class="dv">3</span>
<span class="kw">print</span>(i)</code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>Often, the index will be set to a number for each cycle of the loop, and then the index will be used within the code to index vectors or dataframes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">study_months &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Jan&quot;</span>, <span class="st">&quot;Feb&quot;</span>, <span class="st">&quot;Mar&quot;</span>)
<span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)){
        <span class="kw">print</span>(study_months[i])
}</code></pre></div>
<pre><code>## [1] &quot;Jan&quot;
## [1] &quot;Mar&quot;</code></pre>
<p>Often, you want to set the index to sequential numbers (e.g., 1, 2, 3, 4). In this case, you can save time by using the <code>:</code> notation to create a vector of a sequence of numbers:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>){
        <span class="kw">print</span>(i)
}</code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3</code></pre>
<p>With this notation, sometimes it may be helpful to use the <code>length</code> function to set the largest index value for the loop as the length of a vector (or <code>nrow</code> for indexing a dataframe). For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">study_months &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Jan&quot;</span>, <span class="st">&quot;Feb&quot;</span>, <span class="st">&quot;Mar&quot;</span>)
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(study_months)){
        <span class="kw">print</span>(study_months[i])
}</code></pre></div>
<pre><code>## [1] &quot;Jan&quot;
## [1] &quot;Feb&quot;
## [1] &quot;Mar&quot;</code></pre>
<p>Sometimes, you want to set the index for each cycle of the loop to something that is not a number. You can set the index to any class of vector.</p>
<p>Remember that a loop works by saying for <strong>some index</strong> in <strong>some vector</strong>, do <strong>some code</strong>. For example, you may want to run: for <code>study_month</code> in <code>study_months</code>, <code>print(study_month)</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">study_months &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Jan&quot;</span>, <span class="st">&quot;Feb&quot;</span>, <span class="st">&quot;Mar&quot;</span>)
<span class="cf">for</span>(study_month <span class="cf">in</span> study_months){
        <span class="kw">print</span>(study_month)
}</code></pre></div>
<pre><code>## [1] &quot;Jan&quot;
## [1] &quot;Feb&quot;
## [1] &quot;Mar&quot;</code></pre>
<p>Note that this is equivalent to:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">study_month &lt;-<span class="st"> &quot;Jan&quot;</span>
<span class="kw">print</span>(study_month)</code></pre></div>
<pre><code>## [1] &quot;Jan&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">study_month &lt;-<span class="st"> &quot;Feb&quot;</span>
<span class="kw">print</span>(study_month)</code></pre></div>
<pre><code>## [1] &quot;Feb&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">study_month &lt;-<span class="st"> &quot;Mar&quot;</span>
<span class="kw">print</span>(study_month)</code></pre></div>
<pre><code>## [1] &quot;Mar&quot;</code></pre>
<p>What would this loop do?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Time&quot;</span>, <span class="st">&quot;Shots&quot;</span>, <span class="st">&quot;Passes&quot;</span>, <span class="st">&quot;Tackles&quot;</span>, <span class="st">&quot;Saves&quot;</span>)
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(vars)){
        var_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(worldcup[ , vars[i]])
        <span class="kw">print</span>(var_mean)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Time&quot;</span>, <span class="st">&quot;Shots&quot;</span>, <span class="st">&quot;Passes&quot;</span>, <span class="st">&quot;Tackles&quot;</span>, <span class="st">&quot;Saves&quot;</span>)
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(vars)){
        var_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(worldcup[ , vars[i]])
        <span class="kw">print</span>(var_mean)
}</code></pre></div>
<pre><code>## [1] 208.8639
## [1] 2.304202
## [1] 84.52101
## [1] 4.191597
## [1] 0.6672269</code></pre>
<p>What would this loop do?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Time&quot;</span>, <span class="st">&quot;Shots&quot;</span>, <span class="st">&quot;Passes&quot;</span>, <span class="st">&quot;Tackles&quot;</span>, <span class="st">&quot;Saves&quot;</span>)
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(vars)){
        var_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(worldcup[ , vars[i]])
        var_mean &lt;-<span class="st"> </span><span class="kw">round</span>(var_mean, <span class="dv">1</span>)
        out &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;mean of &quot;</span>, vars[i], <span class="st">&quot;: &quot;</span>, var_mean)
        <span class="kw">print</span>(out)
}</code></pre></div>
<p>To figure out, you can set <code>i &lt;- 1</code> and then walk through the loop:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">i &lt;-<span class="st"> </span><span class="dv">1</span>
(var_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(worldcup[ , vars[i]]))</code></pre></div>
<pre><code>## [1] 208.8639</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(var_mean &lt;-<span class="st"> </span><span class="kw">round</span>(var_mean, <span class="dv">1</span>))</code></pre></div>
<pre><code>## [1] 208.9</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(out &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;mean of &quot;</span>, vars[i], <span class="st">&quot;: &quot;</span>, var_mean))</code></pre></div>
<pre><code>## [1] &quot;mean of Time: 208.9&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Time&quot;</span>, <span class="st">&quot;Shots&quot;</span>, <span class="st">&quot;Passes&quot;</span>, <span class="st">&quot;Tackles&quot;</span>, <span class="st">&quot;Saves&quot;</span>)
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(vars)){
        var_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(worldcup[ , vars[i]])
        var_mean &lt;-<span class="st"> </span><span class="kw">round</span>(var_mean, <span class="dv">1</span>)
        out &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;mean of &quot;</span>, vars[i], <span class="st">&quot;: &quot;</span>, var_mean)
        <span class="kw">print</span>(out)
}</code></pre></div>
<pre><code>## [1] &quot;mean of Time: 208.9&quot;
## [1] &quot;mean of Shots: 2.3&quot;
## [1] &quot;mean of Passes: 84.5&quot;
## [1] &quot;mean of Tackles: 4.2&quot;
## [1] &quot;mean of Saves: 0.7&quot;</code></pre>
<p>Often, it’s convenient to create a dataset to fill up as you loop through:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Time&quot;</span>, <span class="st">&quot;Shots&quot;</span>, <span class="st">&quot;Passes&quot;</span>, <span class="st">&quot;Tackles&quot;</span>, <span class="st">&quot;Saves&quot;</span>)
my_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">variable =</span> vars, <span class="dt">mean =</span> <span class="ot">NA</span>)
<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(my_df)){
        var_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(worldcup[ , vars[i]])
        my_df[i , <span class="st">&quot;mean&quot;</span>] &lt;-<span class="st"> </span><span class="kw">round</span>(var_mean, <span class="dv">1</span>)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Time&quot;</span>, <span class="st">&quot;Shots&quot;</span>, <span class="st">&quot;Passes&quot;</span>, <span class="st">&quot;Tackles&quot;</span>, <span class="st">&quot;Saves&quot;</span>)
(my_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">variable =</span> vars, <span class="dt">mean =</span> <span class="ot">NA</span>))</code></pre></div>
<pre><code>##   variable mean
## 1     Time   NA
## 2    Shots   NA
## 3   Passes   NA
## 4  Tackles   NA
## 5    Saves   NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">i &lt;-<span class="st"> </span><span class="dv">1</span>
(var_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(worldcup[ , vars[i]]))</code></pre></div>
<pre><code>## [1] 208.8639</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_df[i , <span class="st">&quot;mean&quot;</span>] &lt;-<span class="st"> </span><span class="kw">round</span>(var_mean, <span class="dv">1</span>)
my_df</code></pre></div>
<pre><code>##   variable  mean
## 1     Time 208.9
## 2    Shots    NA
## 3   Passes    NA
## 4  Tackles    NA
## 5    Saves    NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(my_df)){
        var_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(worldcup[ , vars[i]])
        my_df[i , <span class="st">&quot;mean&quot;</span>] &lt;-<span class="st"> </span><span class="kw">round</span>(var_mean, <span class="dv">1</span>)
}
my_df</code></pre></div>
<pre><code>##   variable  mean
## 1     Time 208.9
## 2    Shots   2.3
## 3   Passes  84.5
## 4  Tackles   4.2
## 5    Saves   0.7</code></pre>
<p>Note: This is a pretty simplistic example. There are some easier ways to have done this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">worldcup <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">Time =</span> <span class="kw">mean</span>(Time), <span class="dt">Passes =</span> <span class="kw">mean</span>(Passes),
            <span class="dt">Shots =</span> <span class="kw">mean</span>(Shots), <span class="dt">Tackles =</span> <span class="kw">mean</span>(Tackles),
            <span class="dt">Saves =</span> <span class="kw">mean</span>(Saves)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key =</span> var, <span class="dt">value =</span> mean) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mean =</span> <span class="kw">round</span>(mean, <span class="dv">1</span>))</code></pre></div>
<pre><code>##       var  mean
## 1    Time 208.9
## 2  Passes  84.5
## 3   Shots   2.3
## 4 Tackles   4.2
## 5   Saves   0.7</code></pre>
<p>Another way to have done this is with <code>apply</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">means &lt;-<span class="st"> </span><span class="kw">apply</span>(worldcup[ , vars], <span class="dv">2</span>, mean)
(means &lt;-<span class="st"> </span><span class="kw">round</span>(means, <span class="dv">1</span>))</code></pre></div>
<pre><code>##    Time   Shots  Passes Tackles   Saves 
##   208.9     2.3    84.5     4.2     0.7</code></pre>
<p>However, you can use this same looping process for much more complex tasks that you can’t do as easily with <code>apply</code> or <code>dplyr</code> tools.</p>
<p>Loops can be very useful for more complex repeated tasks. For example:</p>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-379-1.png" width="576" /></p>
<p>Creating this graph requires that you:</p>
<ul>
<li>Create a subset limited to each of the four positions</li>
<li>Fit a Poisson regression of Passes on Time within each subset</li>
<li>Pull the regression coefficient and standard error from each model</li>
<li>Use those values to calculate 95% confidence intervals</li>
<li>Convert everything from log relative rate to relative rate</li>
<li>Plot everything</li>
</ul>
<p>Create a vector with the names of all positions. Create an empty dataframe to store regression results:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(positions &lt;-<span class="st"> </span><span class="kw">unique</span>(worldcup<span class="op">$</span>Position))</code></pre></div>
<pre><code>## [1] Midfielder Defender   Forward    Goalkeeper
## Levels: Defender Forward Goalkeeper Midfielder</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(pos_est &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">position =</span> positions,
                       <span class="dt">est =</span> <span class="ot">NA</span>, <span class="dt">se =</span> <span class="ot">NA</span>))</code></pre></div>
<pre><code>##     position est se
## 1 Midfielder  NA NA
## 2   Defender  NA NA
## 3    Forward  NA NA
## 4 Goalkeeper  NA NA</code></pre>
<p>Loop through and fit a Poisson regression model for each subset of data. Save regression coefficients in the empty dataframe:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(pos_est)){
        pos_df &lt;-<span class="st"> </span>worldcup <span class="op">%&gt;%</span>
<span class="st">          </span><span class="kw">filter</span>(Position <span class="op">==</span><span class="st"> </span>positions[i]) 
        pos_mod &lt;-<span class="st"> </span><span class="kw">glm</span>(Passes <span class="op">~</span><span class="st"> </span>Time,
                       <span class="dt">data =</span> pos_df,
                       <span class="dt">family =</span> <span class="kw">poisson</span>(<span class="dt">link =</span> <span class="st">&quot;log&quot;</span>))
        pos_coefs &lt;-<span class="st"> </span><span class="kw">summary</span>(pos_mod)<span class="op">$</span>coefficients[<span class="dv">2</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]
        pos_est[i, <span class="kw">c</span>(<span class="st">&quot;est&quot;</span>, <span class="st">&quot;se&quot;</span>)] &lt;-<span class="st"> </span>pos_coefs
}
pos_est[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, ]</code></pre></div>
<pre><code>##     position         est           se
## 1 Midfielder 0.004716096 4.185925e-05
## 2   Defender 0.004616260 5.192736e-05</code></pre>
<p>Calculate 95% confidence intervals for log relative risk values:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pos_est &lt;-<span class="st"> </span>pos_est <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lower_ci =</span> est <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se,
         <span class="dt">upper_ci =</span> est <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se)

pos_est <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(position, est, lower_ci, upper_ci) </code></pre></div>
<pre><code>##     position         est    lower_ci    upper_ci
## 1 Midfielder 0.004716096 0.004634052 0.004798140
## 2   Defender 0.004616260 0.004514483 0.004718038
## 3    Forward 0.005299009 0.005158945 0.005439074
## 4 Goalkeeper 0.003101124 0.002770562 0.003431687</code></pre>
<p>Calculate relative risk per 90 minute increase in minutes played:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pos_est &lt;-<span class="st"> </span>pos_est <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rr_est =</span> <span class="kw">exp</span>(<span class="dv">90</span> <span class="op">*</span><span class="st"> </span>est),
         <span class="dt">rr_low =</span> <span class="kw">exp</span>(<span class="dv">90</span> <span class="op">*</span><span class="st"> </span>lower_ci),
         <span class="dt">rr_high =</span> <span class="kw">exp</span>(<span class="dv">90</span> <span class="op">*</span><span class="st"> </span>upper_ci))
pos_est <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(position, rr_est, rr_low, rr_high) </code></pre></div>
<pre><code>##     position   rr_est   rr_low  rr_high
## 1 Midfielder 1.528747 1.517501 1.540077
## 2   Defender 1.515073 1.501258 1.529015
## 3    Forward 1.611090 1.590908 1.631527
## 4 Goalkeeper 1.321941 1.283192 1.361861</code></pre>
<p>Re-level the <code>position</code> factor so the plot will be ordered from highest to lowest estimates:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pos_est &lt;-<span class="st"> </span><span class="kw">arrange</span>(pos_est, rr_est) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">mutate</span>(<span class="dt">position =</span> <span class="kw">factor</span>(position,
                                 <span class="dt">levels =</span> position))
pos_est <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(position, est)</code></pre></div>
<pre><code>##     position         est
## 1 Goalkeeper 0.003101124
## 2   Defender 0.004616260
## 3 Midfielder 0.004716096
## 4    Forward 0.005299009</code></pre>
<p>Create the plot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(pos_est, <span class="kw">aes</span>(<span class="dt">x =</span> rr_low, <span class="dt">y =</span> position)) <span class="op">+</span><span class="st"> </span>
<span class="st">        </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">xend =</span> rr_high, <span class="dt">yend =</span> position)) <span class="op">+</span><span class="st"> </span>
<span class="st">        </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rr_est, <span class="dt">y =</span> position)) <span class="op">+</span><span class="st"> </span>
<span class="st">        </span><span class="kw">theme_few</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">        </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">        </span><span class="kw">scale_x_continuous</span>(<span class="kw">paste</span>(<span class="st">&quot;Relative rate of passes</span><span class="ch">\n</span><span class="st">per&quot;</span>,
                                 <span class="st">&quot;90 minute increase in minutes played&quot;</span>),
                           <span class="dt">limits =</span> <span class="kw">c</span>(<span class="fl">1.0</span>, <span class="kw">max</span>(pos_est<span class="op">$</span>rr_high))) <span class="op">+</span><span class="st"> </span>
<span class="st">        </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> <span class="dv">1</span>), <span class="dt">color =</span> <span class="st">&quot;lightgray&quot;</span>)</code></pre></div>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-385-1.png" width="576" /></p>
</div>
<div id="other-control-structures" class="section level2">
<h2><span class="header-section-number">7.3</span> Other control structures</h2>
<div id="if-else-loops" class="section level3">
<h3><span class="header-section-number">7.3.1</span> if / else loops</h3>
<p>There are other control structures you can use in your R code. Two that you will commonly use within R functions are <code>if</code> and <code>ifelse</code> statements. </p>
<p>An <code>if</code> statement tells R that, <strong>if</strong> a certain condition is true, <strong>do</strong> run some code. For example, if you wanted to print out only odd numbers between 1 and 5, one way to do that is with an <code>if</code> statement: (Note: the <code>%%</code> operator in R returns the remainder of the first value (i) divided by the second value (2).)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>){
  <span class="cf">if</span>(i <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span>){
    <span class="kw">print</span>(i)
  }
}</code></pre></div>
<pre><code>## [1] 1
## [1] 3
## [1] 5</code></pre>
<p>The <code>if</code> statement runs some code if a condition is true, but does nothing if it is false. If you’d like different code to run depending on whether the condition is true or false, you can us an if / else or an if / else if / else statement.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>){
  <span class="cf">if</span>(i <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span>){
    <span class="kw">print</span>(i)
  } <span class="cf">else</span> {
    <span class="kw">print</span>(<span class="kw">paste</span>(i, <span class="st">&quot;is even&quot;</span>))
  }
}</code></pre></div>
<pre><code>## [1] 1
## [1] &quot;2 is even&quot;
## [1] 3
## [1] &quot;4 is even&quot;
## [1] 5</code></pre>
<p>What would this code do? </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">100</span>){
  <span class="cf">if</span>(i <span class="op">%%</span><span class="st"> </span><span class="dv">3</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>i <span class="op">%%</span><span class="st"> </span><span class="dv">5</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>){
    <span class="kw">print</span>(<span class="st">&quot;FizzBuzz&quot;</span>)
  } <span class="cf">else</span> <span class="cf">if</span>(i <span class="op">%%</span><span class="st"> </span><span class="dv">3</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>){
    <span class="kw">print</span>(<span class="st">&quot;Fizz&quot;</span>)
  } <span class="cf">else</span> <span class="cf">if</span>(i <span class="op">%%</span><span class="st"> </span><span class="dv">5</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>){
    <span class="kw">print</span>(<span class="st">&quot;Buzz&quot;</span>)
  } <span class="cf">else</span> {
    <span class="kw">print</span>(i)
  }
}</code></pre></div>
<p>If / else statements are extremely useful in functions. </p>
<p>In R, the <code>if</code> statement evaluates everything in the parentheses and, if that evaluates to <code>TRUE</code>, runs everything in the braces. This means that you can trigger code in an <code>if</code> statement with a single-value logical vector:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">weekend &lt;-<span class="st"> </span><span class="ot">TRUE</span>
<span class="cf">if</span>(weekend){
  <span class="kw">print</span>(<span class="st">&quot;It&#39;s the weekend!&quot;</span>)
}</code></pre></div>
<pre><code>## [1] &quot;It&#39;s the weekend!&quot;</code></pre>
<p>This functionality can be useful with parameters you choose to include when writing your own functions (e.g., <code>print = TRUE</code>).</p>
</div>
<div id="some-other-control-structures" class="section level3">
<h3><span class="header-section-number">7.3.2</span> Some other control structures</h3>
<p>The control structures you are most likely to use in data analysis with R are “for” loops and “if / else” statements. However, there are a few other control structures you may occasionally find useful:</p>
<ul>
<li><code>next</code></li>
<li><code>break</code></li>
<li><code>while</code></li>
</ul>
<p>You can use the <code>next</code> structure to skip to the next round of a loop when a certain condition is met. For example, we could have used this code to print out odd numbers between 1 and 5:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>){
  <span class="cf">if</span>(i <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>){
    <span class="cf">next</span>
  }
  <span class="kw">print</span>(i)
}</code></pre></div>
<pre><code>## [1] 1
## [1] 3
## [1] 5</code></pre>
<p>You can use <code>break</code> to break out of a loop if a certain condition is met. For example, the final code will break out of the loop once <code>i</code> is over 3, so it will only print the numbers 1 through 3:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>){
  <span class="cf">if</span>(i <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span>){
    <span class="cf">break</span>
  }
  <span class="kw">print</span>(i)
}</code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_sum &lt;-<span class="st"> </span><span class="dv">1</span>
<span class="cf">while</span>(my_sum <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>){
  my_sum &lt;-<span class="st"> </span>my_sum <span class="op">*</span><span class="st"> </span><span class="dv">2</span>
  <span class="kw">print</span>(my_sum)
}</code></pre></div>
<pre><code>## [1] 2
## [1] 4
## [1] 8
## [1] 16</code></pre>
</div>
</div>
<div id="functions" class="section level2">
<h2><span class="header-section-number">7.4</span> Functions</h2>
<p>As you move to larger projects, you will find yourself using the same code a lot. </p>
<p>Examples include:</p>
<ul>
<li>Reading in data from a specific type of equipment (air pollution monitor, accelerometer)</li>
<li>Running a specific type of analysis</li>
<li>Creating a specific type of plot or map</li>
</ul>

<p>If you find yourself cutting and pasting a lot, convert the code to a function.</p>
<p>Advantages of writing functions include:</p>
<ul>
<li>Coding is more efficient</li>
<li>Easier to change your code (if you’ve cut and paste code and you want to change something, you have to change it everywhere - this is an easy way to accidentally create bugs in your code)</li>
<li>Easier to share code with others</li>
</ul>
<p>You can name a function anything you want (although try to avoid names of preexisting-existing functions). You then define any inputs (arguments; separate multiple arguments with commas) and put the code to run in braces:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Note: this code will not run
[<span class="cf">function</span> name] &lt;-<span class="st"> </span><span class="cf">function</span>([any arguments]){
        [code to run]
}</code></pre></div>
<p>Here is an example of a very basic function. This function takes a number as input and adds 1 to that number.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">add_one &lt;-<span class="st"> </span><span class="cf">function</span>(number){
        out &lt;-<span class="st"> </span>number <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
        <span class="kw">return</span>(out)
}

<span class="kw">add_one</span>(<span class="dt">number =</span> <span class="dv">3</span>)</code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">add_one</span>(<span class="dt">number =</span> <span class="op">-</span><span class="dv">1</span>)</code></pre></div>
<pre><code>## [1] 0</code></pre>
<ul>
<li>Functions can input any type of R object (for example, vectors, data frames, even other functions and ggplot objects)</li>
<li>Similarly, functions can output any type of R object</li>
<li>When defining a function, you can set default values for some of the parameters</li>
<li>You can explicitly specify the value to return from the function</li>
<li>There are ways to check for errors in the arguments a user inputs to the function</li>
</ul>
<p>For example, the following function inputs a data frame (<code>datafr</code>) and a one-element vector (<code>child_id</code>) and returns only rows in the data frame where it’s <code>id</code> column matches <code>child_id</code>. It includes a default value for <code>datafr</code>, but not for <code>child_id</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">subset_nepali &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">datafr =</span> nepali, child_id){
  datafr &lt;-<span class="st"> </span>datafr <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(id <span class="op">==</span><span class="st"> </span>child_id)
  <span class="kw">return</span>(datafr)
}</code></pre></div>
<p>If an argument is not given for a parameter with a default, the function will run using the default value for that parameter. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">subset_nepali</span>(<span class="dt">child_id =</span> <span class="st">&quot;120011&quot;</span>)</code></pre></div>
<pre><code>##       id  sex   wt   ht mage lit died alive age
## 1 120011 Male 12.8 91.2   35   0    2     5  41
## 2 120011 Male 12.8 93.9   35   0    2     5  45
## 3 120011 Male 13.1 95.2   35   0    2     5  49
## 4 120011 Male 13.8 96.9   35   0    2     5  53
## 5 120011 Male   NA   NA   35   0    2     5  57</code></pre>
<p>If an argument is not given for a parameter without a default, the function call will result in an error. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">subset_nepali</span>(<span class="dt">datafr =</span> nepali)</code></pre></div>
<pre><code>## Error in filter_impl(.data, quo): Evaluation error: argument &quot;child_id&quot; is missing, with no default.</code></pre>
<p>By default, the function will return the last defined object, although the choice of using <code>return</code> can affect printing behavior when you run the function. For example, I could have written the <code>subset_nepali</code> function like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">subset_nepali &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">datafr =</span> nepali, child_id){
  datafr &lt;-<span class="st"> </span>datafr <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(id <span class="op">==</span><span class="st"> </span>child_id)
}</code></pre></div>
<p>In this case, the output will not automatically print out when you call the function without assigning it to an R object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">subset_nepali</span>(<span class="dt">child_id =</span> <span class="st">&quot;120011&quot;</span>)</code></pre></div>
<p>However, the output can be assigned to an R object in the same way as when the function was defined without <code>return</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">first_childs_data &lt;-<span class="st"> </span><span class="kw">subset_nepali</span>(<span class="dt">child_id =</span> <span class="st">&quot;120011&quot;</span>)
first_childs_data</code></pre></div>
<pre><code>##       id  sex   wt   ht mage lit died alive age
## 1 120011 Male 12.8 91.2   35   0    2     5  41
## 2 120011 Male 12.8 93.9   35   0    2     5  45
## 3 120011 Male 13.1 95.2   35   0    2     5  49
## 4 120011 Male 13.8 96.9   35   0    2     5  53
## 5 120011 Male   NA   NA   35   0    2     5  57</code></pre>
<p>The <code>return</code> function can also be used to return an object other than the last defined object (although doesn’t tend to be something you need to do very often). For example, if you did not use <code>return</code> in the following code, it will output “Test output”:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">subset_nepali &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">datafr =</span> nepali, child_id){
  datafr &lt;-<span class="st"> </span>datafr <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(id <span class="op">==</span><span class="st"> </span>child_id)
  a &lt;-<span class="st"> &quot;Test output&quot;</span>
}
(<span class="kw">subset_nepali</span>(<span class="dt">child_id =</span> <span class="st">&quot;120011&quot;</span>))</code></pre></div>
<pre><code>## [1] &quot;Test output&quot;</code></pre>
<p>Conversely, you can use <code>return</code> to output <code>datafr</code>, even though it’s not the last object defined:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">subset_nepali &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">datafr =</span> nepali, child_id){
  datafr &lt;-<span class="st"> </span>datafr <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(id <span class="op">==</span><span class="st"> </span>child_id)
  a &lt;-<span class="st"> &quot;Test output&quot;</span>
  <span class="kw">return</span>(datafr)
}
<span class="kw">subset_nepali</span>(<span class="dt">child_id =</span> <span class="st">&quot;120011&quot;</span>)</code></pre></div>
<pre><code>##       id  sex   wt   ht mage lit died alive age
## 1 120011 Male 12.8 91.2   35   0    2     5  41
## 2 120011 Male 12.8 93.9   35   0    2     5  45
## 3 120011 Male 13.1 95.2   35   0    2     5  49
## 4 120011 Male 13.8 96.9   35   0    2     5  53
## 5 120011 Male   NA   NA   35   0    2     5  57</code></pre>
<p>You can use <code>stop</code> to stop execution of the function and give the user an error message. For example, the <code>subset_nepali</code> function will fail if the user inputs a data frame that does not have a column named “id”:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">subset_nepali</span>(<span class="dt">datafr =</span> <span class="kw">data.frame</span>(<span class="dt">wt =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>)),
              <span class="dt">child_id =</span> <span class="st">&quot;12011&quot;</span>)</code></pre></div>
<pre><code> Error: comparison (1) is possible only for 
 atomic and list types </code></pre>
<p>You can rewrite the function to stop if the input <code>datafr</code> does not have a column named “id”:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">subset_nepali &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">datafr =</span> nepali, child_id){
  <span class="cf">if</span>(<span class="op">!</span>(<span class="st">&quot;id&quot;</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">colnames</span>(datafr))){
    <span class="kw">stop</span>(<span class="st">&quot;`datafr` must include a column named `id`&quot;</span>)
  }
  datafr &lt;-<span class="st"> </span>datafr <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(id <span class="op">==</span><span class="st"> </span>child_id)
  <span class="kw">return</span>(datafr)
}
<span class="kw">subset_nepali</span>(<span class="dt">datafr =</span> <span class="kw">data.frame</span>(<span class="dt">wt =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>)),
              <span class="dt">child_id =</span> <span class="st">&quot;12011&quot;</span>)</code></pre></div>
<pre><code>Error in subset_nepali(datafr = data.frame(wt = rnorm(10)),
child_id = &quot;12011&quot;) : 
  `datafr` must include a column named `id`</code></pre>
<p>The <code>stop</code> function is particularly important if the function would keep running with the wrong input, but would result in the wrong output. </p>
<p>You can also output warnings and messages using the functions <code>warning</code> and <code>message</code>.</p>
</div>
<div id="regular-expressions" class="section level2">
<h2><span class="header-section-number">7.5</span> Regular expressions</h2>
<p>For these examples, we’ll use some data on passengers of the Titanic. You can load this data using:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages(&quot;titanic&quot;)</span>
<span class="kw">library</span>(titanic)
<span class="kw">data</span>(<span class="st">&quot;titanic_train&quot;</span>)</code></pre></div>
<p>We will be using the <code>stringr</code> package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(stringr)</code></pre></div>
<p>This data includes a column called “Name” with passenger names. This column is somewhat messy and includes several elements that we might want to separate (last name, first name, title). Here are the first few values of “Name”:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">titanic_train <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Name) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</code></pre></div>
<pre><code>## # A tibble: 3 x 1
##                                                  Name
##                                                 &lt;chr&gt;
## 1                             Braund, Mr. Owen Harris
## 2 Cumings, Mrs. John Bradley (Florence Briggs Thayer)
## 3                              Heikkinen, Miss. Laina</code></pre>
<p>We’ve already done some things to manipulate strings. For example, if we wanted to separate “Name” into last name and first name (including title), we could actually do that with the <code>separate</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">titanic_train <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(Name) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">separate</span>(Name, <span class="kw">c</span>(<span class="st">&quot;last_name&quot;</span>, <span class="st">&quot;first_name&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;, &quot;</span>)</code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   last_name                                 first_name
## *     &lt;chr&gt;                                      &lt;chr&gt;
## 1    Braund                            Mr. Owen Harris
## 2   Cumings Mrs. John Bradley (Florence Briggs Thayer)
## 3 Heikkinen                                Miss. Laina</code></pre>
<p>Notice that <code>separate</code> is looking for a regular pattern (“,”) and then doing something based on the location of that pattern in each string (splitting the string). </p>
<p>There are a variety of functions in R that can perform manipulations based on finding regular patterns in character strings.</p>
<p>The <code>str_detect</code> function will look through each element of a character vector for a designated pattern. If the pattern is there, it will return <code>TRUE</code>, and otherwise <code>FALSE</code>. The convention is:</p>
<pre><code>## Generic code
str_detect(string = [vector you want to check], 
           pattern = [pattern you want to check for])</code></pre>
<p>For example, to create a logical vector specifying which of the Titanic passenger names include “Mrs.”, you can call:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mrs &lt;-<span class="st"> </span><span class="kw">str_detect</span>(titanic_train<span class="op">$</span>Name, <span class="st">&quot;Mrs.&quot;</span>)
<span class="kw">head</span>(mrs)</code></pre></div>
<pre><code>## [1] FALSE  TRUE FALSE  TRUE FALSE FALSE</code></pre>
<p>The result is a logical vector, so <code>str_detect</code> can be used in <code>filter</code> to subset data to only rows where the passenger’s name includes “Mrs.”:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">titanic_train <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(Name, <span class="st">&quot;Mrs.&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(Name) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</code></pre></div>
<pre><code>## # A tibble: 3 x 1
##                                                  Name
##                                                 &lt;chr&gt;
## 1 Cumings, Mrs. John Bradley (Florence Briggs Thayer)
## 2        Futrelle, Mrs. Jacques Heath (Lily May Peel)
## 3   Johnson, Mrs. Oscar W (Elisabeth Vilhelmina Berg)</code></pre>
<p>There is an older, base R function called <code>grepl</code> that does something very similar (although note that the order of the arguments is reversed).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">titanic_train <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">grepl</span>(<span class="st">&quot;Mrs.&quot;</span>, Name)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(Name) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</code></pre></div>
<pre><code>## # A tibble: 3 x 1
##                                                  Name
##                                                 &lt;chr&gt;
## 1 Cumings, Mrs. John Bradley (Florence Briggs Thayer)
## 2        Futrelle, Mrs. Jacques Heath (Lily May Peel)
## 3   Johnson, Mrs. Oscar W (Elisabeth Vilhelmina Berg)</code></pre>
<p>The <code>str_extract</code> function can be used to extract a string (if it exists) from each value in a character vector. It follows similar conventions to <code>str_detect</code>:</p>
<pre><code>## Generic code
str_extract(string = [vector you want to check], 
           pattern = [pattern you want to check for])</code></pre>
<p>For example, you might want to extract “Mrs.” if it exists in a passenger’s name:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">titanic_train <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mrs =</span> <span class="kw">str_extract</span>(Name, <span class="st">&quot;Mrs.&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(Name, mrs) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</code></pre></div>
<pre><code>## # A tibble: 3 x 2
##                                                  Name   mrs
##                                                 &lt;chr&gt; &lt;chr&gt;
## 1                             Braund, Mr. Owen Harris  &lt;NA&gt;
## 2 Cumings, Mrs. John Bradley (Florence Briggs Thayer)  Mrs.
## 3                              Heikkinen, Miss. Laina  &lt;NA&gt;</code></pre>
<p>Notice that now we’re creating a new column (<code>mrs</code>) that either has “Mrs.” (if there’s a match) or is missing (<code>NA</code>) if there’s not a match.</p>
<p>For this first example, we were looking for an exact string (“Mrs”). However, you can use patterns that match a particular pattern, but not an exact string. For example, we could expand the regular expression to find “Mr.” or “Mrs.”:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">titanic_train <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">title =</span> <span class="kw">str_extract</span>(Name, <span class="st">&quot;Mr</span><span class="ch">\\</span><span class="st">.|Mrs</span><span class="ch">\\</span><span class="st">.&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(Name, title) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</code></pre></div>
<pre><code>## # A tibble: 3 x 2
##                                                  Name title
##                                                 &lt;chr&gt; &lt;chr&gt;
## 1                             Braund, Mr. Owen Harris   Mr.
## 2 Cumings, Mrs. John Bradley (Florence Briggs Thayer)  Mrs.
## 3                              Heikkinen, Miss. Laina  &lt;NA&gt;</code></pre>
<p>Note that this pattern uses a special operator (<code>|</code>) to find one pattern <strong>or</strong> another. Double backslashes (<code>\\</code>) <strong>escape</strong> the special character “.”.</p>
<p>As a note, in regular expressions, all of the following characters are special characters that need to be escaped with backslashes if you want to use them literally:</p>
<pre><code>. * + ^ ? $ \ | ( ) [ ] { }</code></pre>
<p>Notice that “Mr.” and “Mrs.” both start with “Mr”, end with “.”, and may or may not have an “s” in between.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">titanic_train <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">title =</span> <span class="kw">str_extract</span>(Name, <span class="st">&quot;Mr(s)*</span><span class="ch">\\</span><span class="st">.&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(Name, title) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</code></pre></div>
<pre><code>## # A tibble: 3 x 2
##                                                  Name title
##                                                 &lt;chr&gt; &lt;chr&gt;
## 1                             Braund, Mr. Owen Harris   Mr.
## 2 Cumings, Mrs. John Bradley (Florence Briggs Thayer)  Mrs.
## 3                              Heikkinen, Miss. Laina  &lt;NA&gt;</code></pre>
<p>This pattern uses <code>(s)*</code> to match zero or more “s”s at this spot in the pattern.</p>
<p>In the previous code, we found “Mr.” and “Mrs.”, but missed “Miss.”. We could tweak the pattern again to try to capture that, as well. For all three, we have the pattern that it starts with “M”, has some lowercase letters, and then ends with “.”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">titanic_train <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">title =</span> <span class="kw">str_extract</span>(Name, <span class="st">&quot;M[a-z]+</span><span class="ch">\\</span><span class="st">.&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(Name, title) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</code></pre></div>
<pre><code>## # A tibble: 3 x 2
##                                                  Name title
##                                                 &lt;chr&gt; &lt;chr&gt;
## 1                             Braund, Mr. Owen Harris   Mr.
## 2 Cumings, Mrs. John Bradley (Florence Briggs Thayer)  Mrs.
## 3                              Heikkinen, Miss. Laina Miss.</code></pre>
<p>The last pattern used <code>[a-z]+</code> to match one or more lowercase letters. The <code>[a-z]</code>is a <strong>character class</strong>. </p>
<p>You can also match digits (<code>[0-9]</code>), uppercase letters (<code>[A-Z]</code>), just some letters (<code>[aeiou]</code>), etc. </p>
<p>You can negate a character class by starting it with <code>^</code>. For example, <code>[^0-9]</code> will match anything that <strong>isn’t</strong> a digit.</p>
<p>Sometimes, you want to match a pattern, but then only subset a part of it. For example, each passenger seems to have a title (“Mr.”, “Mrs.”, etc.) that comes after “,” and before “.”. We can use this pattern to find the title, but then we get some extra stuff with the match:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">titanic_train <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">title =</span> <span class="kw">str_extract</span>(Name, <span class="st">&quot;,</span><span class="ch">\\</span><span class="st">s[A-Za-z]*</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">s&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(title) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</code></pre></div>
<pre><code>## # A tibble: 3 x 1
##      title
##      &lt;chr&gt;
## 1   , Mr. 
## 2  , Mrs. 
## 3 , Miss.</code></pre>
<p>As a note, in this pattern, <code>\\s</code> is used to match a space.</p>
<p>We are getting things like “, Mr.”, when we really want “Mr”. We can use the <code>str_match</code> function to do this. We group what we want to extract from the pattern in parentheses, and then the function returns a matrix. The first column is the full pattern match, and each following column gives just what matches within the groups.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">str_match</span>(titanic_train<span class="op">$</span>Name,
          <span class="dt">pattern =</span> <span class="st">&quot;,</span><span class="ch">\\</span><span class="st">s([A-Za-z]*)</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">s&quot;</span>))</code></pre></div>
<pre><code>##      [,1]       [,2]  
## [1,] &quot;, Mr. &quot;   &quot;Mr&quot;  
## [2,] &quot;, Mrs. &quot;  &quot;Mrs&quot; 
## [3,] &quot;, Miss. &quot; &quot;Miss&quot;
## [4,] &quot;, Mrs. &quot;  &quot;Mrs&quot; 
## [5,] &quot;, Mr. &quot;   &quot;Mr&quot;  
## [6,] &quot;, Mr. &quot;   &quot;Mr&quot;</code></pre>
<p>To get just the title, then, we can run:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">titanic_train <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">title =</span> 
           <span class="kw">str_match</span>(Name, <span class="st">&quot;,</span><span class="ch">\\</span><span class="st">s([A-Za-z]*)</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">s&quot;</span>)[ , <span class="dv">2</span>]) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(Name, title) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</code></pre></div>
<pre><code>## # A tibble: 3 x 2
##                                                  Name title
##                                                 &lt;chr&gt; &lt;chr&gt;
## 1                             Braund, Mr. Owen Harris    Mr
## 2 Cumings, Mrs. John Bradley (Florence Briggs Thayer)   Mrs
## 3                              Heikkinen, Miss. Laina  Miss</code></pre>
<p>The <code>[ , 2]</code> pulls out just the second column from the matrix returned by <code>str_match</code>.</p>
<p>Here are some of the most common titles:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">titanic_train <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">title =</span> 
           <span class="kw">str_match</span>(Name, <span class="st">&quot;,</span><span class="ch">\\</span><span class="st">s([A-Za-z]*)</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">s&quot;</span>)[ , <span class="dv">2</span>]) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(title) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</code></pre></div>
<pre><code>## # A tibble: 5 x 2
##    title     n
##    &lt;chr&gt; &lt;int&gt;
## 1     Mr   517
## 2   Miss   182
## 3    Mrs   125
## 4 Master    40
## 5     Dr     7</code></pre>
<p>Here are a few other examples of regular expressions in action with this dataset. </p>
<p>Get just names that start with (“^”) the letter “A”:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">titanic_train <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(Name, <span class="st">&quot;^A&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(Name) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</code></pre></div>
<pre><code>## # A tibble: 3 x 1
##                                                        Name
##                                                       &lt;chr&gt;
## 1                                  Allen, Mr. William Henry
## 2                               Andersson, Mr. Anders Johan
## 3 Asplund, Mrs. Carl Oscar (Selma Augusta Emilia Johansson)</code></pre>
<p>Get names with “II” or “III” (<code>{2,}</code> says to match at least two times):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">titanic_train <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(Name, <span class="st">&quot;I{2,}&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(Name) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</code></pre></div>
<pre><code>## # A tibble: 2 x 1
##                                   Name
##                                  &lt;chr&gt;
## 1  Carter, Master. William Thornton II
## 2 Roebling, Mr. Washington Augustus II</code></pre>
<p>Get names with “Andersen” or “Anderson” (alternatives in square brackets):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">titanic_train <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(Name, <span class="st">&quot;Anders[eo]n&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(Name)</code></pre></div>
<pre><code>##                                              Name
## 1 Andersen-Jensen, Miss. Carla Christine Nielsine
## 2                             Anderson, Mr. Harry
## 3                    Walker, Mr. William Anderson
## 4                     Olsvigen, Mr. Thor Anderson
## 5      Soholt, Mr. Peter Andreas Lauritz Andersen</code></pre>
<p>Get names that start with (“^” outside of brackets) the letters “A” and “B”:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">titanic_train <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(Name, <span class="st">&quot;^[AB]&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(Name) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</code></pre></div>
<pre><code>## # A tibble: 3 x 1
##                       Name
##                      &lt;chr&gt;
## 1  Braund, Mr. Owen Harris
## 2 Allen, Mr. William Henry
## 3 Bonnell, Miss. Elizabeth</code></pre>
<p>Get names that end with (“$”) the letter “b” (either lowercase or uppercase):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">titanic_train <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(Name, <span class="st">&quot;[bB]$&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(Name) </code></pre></div>
<pre><code>##                        Name
## 1   Emir, Mr. Farred Chehab
## 2 Goldschmidt, Mr. George B
## 3           Cook, Mr. Jacob
## 4          Pasic, Mr. Jakob</code></pre>
<p>Some useful regular expression operators include:</p>
<table>
<thead>
<tr class="header">
<th align="left">Operator</th>
<th align="left">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">.</td>
<td align="left">Any character</td>
</tr>
<tr class="even">
<td align="left">*</td>
<td align="left">Match 0 or more times (greedy)</td>
</tr>
<tr class="odd">
<td align="left">*?</td>
<td align="left">Match 0 or more times (non-greedy)</td>
</tr>
<tr class="even">
<td align="left">+</td>
<td align="left">Match 1 or more times (greedy)</td>
</tr>
<tr class="odd">
<td align="left">+?</td>
<td align="left">Match 1 or more times (non-greedy)</td>
</tr>
<tr class="even">
<td align="left">^</td>
<td align="left">Starts with (in brackets, negates)</td>
</tr>
<tr class="odd">
<td align="left">$</td>
<td align="left">Ends with</td>
</tr>
<tr class="even">
<td align="left">[…]</td>
<td align="left">Character classes</td>
</tr>
</tbody>
</table>
<p>For more on these patterns, see:</p>
<ul>
<li>Help file for the <code>stringi-search-regex</code> function in the <code>stringi</code> package (which should install when you install <code>stringr</code>)</li>
<li><a href="https://cran.r-project.org/web/packages/stringr/vignettes/stringr.html">Introduction to stringr</a> by Hadley Wickham</li>
<li><a href="http://gastonsanchez.com/Handling_and_Processing_Strings_in_R.pdf">Handling and Processing Strings in R</a> by Gaston Sanchez (seven chapter ebook)</li>
<li><a href="http://gskinner.com/RegExr" class="uri">http://gskinner.com/RegExr</a> and <a href="http://www.txt2re.com" class="uri">http://www.txt2re.com</a>: Interactive tools for helping you build regular expression pattern strings</li>
</ul>
</div>
<div id="in-course-exercise-6" class="section level2">
<h2><span class="header-section-number">7.6</span> In-course exercise</h2>
<div id="exploring-fatality-analysis-reporting-system-fars-data-1" class="section level3">
<h3><span class="header-section-number">7.6.1</span> Exploring Fatality Analysis Reporting System (FARS) data</h3>
<ul>
<li>Visit <a href="http://metrocosm.com/10-years-of-traffic-accidents-mapped.html" class="uri">http://metrocosm.com/10-years-of-traffic-accidents-mapped.html</a> and explore the interactive visualization created by Max Galka using this public dataset on US fatal motor vehicle accidents.</li>
<li>Go to <a href="http://www.nhtsa.gov/Data/Fatality-Analysis-Reporting-System-(FARS)">FARS web page</a> to find and download the data for this week’s exercise. We want to get the raw data on fatal accidents. Navigate this page to figure out how you can get this raw data for the whole county for 2015. Download the 2015 data to your computer. What is the structure of how this data is saved (e.g., directory structure, file structure)?</li>
<li>On the <a href="http://www.nhtsa.gov/Data/Fatality-Analysis-Reporting-System-(FARS)">FARS web page</a>, find the documentation describing this raw data. Look through both this documentation and the raw files you downloaded to figure out what information is included in the data.</li>
<li>Read the <code>accident.csv</code> file for 2015 into R (this is one of the files you’ll get if you download the raw data for 2015). Use the documentation to figure out what each column represents.</li>
<li>Discuss what steps you would need to take to create the following plot. To start, don’t write any code, just develop a plan. Talk about what the dataset should look like right before you create the plot and what functions you could use to get the data from its current format to that format. (Hint: Functions from the <code>lubridate</code> package will be very helpful, including <code>yday</code> and <code>wday</code>).</li>
<li>Discuss which of the variables in this dataset could be used to merge the dataset with other appropriate data, either other datasets in the FARS raw data, or outside datasets.</li>
<li>Try to write the code to create the plot below. This will include some code for cleaning the data and some code for plotting. There is an example answer below, but I’d like you to try to figure it out yourselves first.</li>
</ul>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-426-1.png" width="576" style="display: block; margin: auto;" /></p>
<div id="example-r-code-12" class="section level4">
<h4><span class="header-section-number">7.6.1.1</span> Example R code</h4>
<p>Here is example code for the section above:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(lubridate)
<span class="kw">library</span>(ggthemes)

accident &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/accident.csv&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(DAY<span class="op">:</span>MINUTE) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>DAY_WEEK) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unite</span>(date, DAY<span class="op">:</span>MINUTE, <span class="dt">sep =</span> <span class="st">&quot;-&quot;</span>, <span class="dt">remove =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">dmy_hm</span>(date), 
         <span class="dt">yday =</span> <span class="kw">yday</span>(date),
         <span class="dt">weekday =</span> <span class="kw">wday</span>(date, <span class="dt">label =</span> <span class="ot">TRUE</span>, <span class="dt">abbr =</span> <span class="ot">FALSE</span>),
         <span class="dt">weekend =</span> weekday <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Saturday&quot;</span>, <span class="st">&quot;Sunday&quot;</span>)) 

accident <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(yday)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(yday) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">accidents =</span> <span class="kw">n</span>(),
            <span class="dt">weekend =</span> <span class="kw">first</span>(weekend)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> yday, <span class="dt">y =</span> accidents, <span class="dt">color =</span> weekend)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Day of the year in 2015&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;# of fatal accidents&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme_few</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-427-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="using-a-loop-to-create-state-specific-plots" class="section level3">
<h3><span class="header-section-number">7.6.2</span> Using a loop to create state-specific plots</h3>
<p>Next, you will write a loop to write a four-page pdf file with state-specific plots for the states of Colorado, Texas, California, and New York.</p>
<ul>
<li>The data has a column called <code>STATE</code>, but it gives state as a one- or two-digit code, rather than by name. These codes are the state Federal Information Processing Standard (FIPS) codes. A dataset with state names and FIPS codes is available at <a href="http://www2.census.gov/geo/docs/reference/state.txt" class="uri">http://www2.census.gov/geo/docs/reference/state.txt</a>. Read that data into an R object called <code>state_fips</code> and clean it so the first few lines look like this:</li>
</ul>
<pre><code>## # A tibble: 5 x 2
##   state state_name
##   &lt;int&gt;      &lt;chr&gt;
## 1     1    Alabama
## 2     2     Alaska
## 3     4    Arizona
## 4     5   Arkansas
## 5     6 California</code></pre>
<ul>
<li>Read the 2015 FARS data into an R object named <code>accident</code>. Use all the date and time information to create a column named <code>date</code> with the date and time of the accident. Include information on whether the accident was related to drunk driving (FALSE if there were 0 drunk drivers, TRUE if there were one or more), and create columns that gives whether the accident was during the day (7 AM to 7 PM) or not as well as the month of the accident (for this last column, you can either retain it from the original data or recalculate it based on the new <code>date</code> variable). Filter out any values where the date-time does not render (i.e., <code>date</code> is a missing value). The first few rows of the cleaned dataframe should look like this:</li>
</ul>
<pre><code>## # A tibble: 5 x 5
##   state                date drunk_dr daytime month
##   &lt;int&gt;              &lt;dttm&gt;    &lt;lgl&gt;   &lt;lgl&gt; &lt;dbl&gt;
## 1     1 2015-01-01 02:40:00     TRUE   FALSE     1
## 2     1 2015-01-01 22:13:00    FALSE   FALSE     1
## 3     1 2015-01-01 01:25:00     TRUE   FALSE     1
## 4     1 2015-01-04 00:57:00     TRUE   FALSE     1
## 5     1 2015-01-07 07:09:00    FALSE    TRUE     1</code></pre>
<ul>
<li>Join the information from <code>state_fips</code> into the <code>accident</code> dataframe. There may be a few locations in the <code>state_fips</code> dataframe that are not included in the <code>accident</code> dataframe (e.g., Virgin Islands), so when you join keep all observations in <code>accident</code> but only the observations in <code>state_fips</code> that match at least one row of <code>accident</code>. The first few rows of the joined dataset should look like this:</li>
</ul>
<pre><code>## # A tibble: 5 x 6
##   state                date drunk_dr daytime month state_name
##   &lt;int&gt;              &lt;dttm&gt;    &lt;lgl&gt;   &lt;lgl&gt; &lt;dbl&gt;      &lt;chr&gt;
## 1     1 2015-01-01 02:40:00     TRUE   FALSE     1    Alabama
## 2     1 2015-01-01 22:13:00    FALSE   FALSE     1    Alabama
## 3     1 2015-01-01 01:25:00     TRUE   FALSE     1    Alabama
## 4     1 2015-01-04 00:57:00     TRUE   FALSE     1    Alabama
## 5     1 2015-01-07 07:09:00    FALSE    TRUE     1    Alabama</code></pre>
<ul>
<li>Write the code to create boxplots for Colorado of the distribution of total accidents within each month. Create separate boxplots for daytime and nighttime accidents, and facet by whether the accident was related to drunk driving. The plot should look like the plot below.</li>
</ul>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-431-1.png" width="576" style="display: block; margin: auto;" /></p>
<ul>
<li>Write a loop to create a plot like the one you just made for Colorado for four different states – Colorado, Texas, California, and New York. The code should write the plots out to a pdf, with one plot per page of the pdf. (<em>Hint</em>: To get a loop to print out a plot created with ggplot, you must explicitly print the plot object. For example, you could assign the plot to <code>a</code>, and then you would run <code>print(a)</code> within your loop as the last step.)</li>
</ul>
<div id="example-r-code-13" class="section level4">
<h4><span class="header-section-number">7.6.2.1</span> Example R code</h4>
<p>Here is example R code for creating state-specific plots using a loop:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">state_fips &lt;-<span class="st"> </span><span class="kw">read_delim</span>(<span class="st">&quot;http://www2.census.gov/geo/docs/reference/state.txt&quot;</span>,
                         <span class="dt">delim =</span> <span class="st">&quot;|&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">state =</span> STATE,
         <span class="dt">state_name =</span> STATE_NAME) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(state, state_name) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">state =</span> <span class="kw">as.integer</span>(state))

accident &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/accident.csv&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(STATE, DAY<span class="op">:</span>MINUTE, DRUNK_DR) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">state =</span> STATE, 
         <span class="dt">drunk_dr =</span> DRUNK_DR) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>DAY_WEEK) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unite</span>(date, DAY<span class="op">:</span>MINUTE, <span class="dt">sep =</span> <span class="st">&quot;-&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">dmy_hm</span>(date), 
         <span class="dt">drunk_dr =</span> drunk_dr <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1</span>,
         <span class="dt">daytime =</span> <span class="kw">hour</span>(date) <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">7</span><span class="op">:</span><span class="dv">19</span>),
         <span class="dt">month =</span> <span class="kw">month</span>(date)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(date)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(state_fips, <span class="dt">by =</span> <span class="st">&quot;state&quot;</span>)

<span class="kw">pdf</span>(<span class="st">&quot;StateFARSPlots.pdf&quot;</span>, <span class="dt">height =</span> <span class="fl">3.5</span>, <span class="dt">width =</span> <span class="dv">7</span>)
state_list &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Colorado&quot;</span>, <span class="st">&quot;Texas&quot;</span>, <span class="st">&quot;California&quot;</span>, <span class="st">&quot;New York&quot;</span>)
<span class="cf">for</span>(which_state <span class="cf">in</span> state_list){
  a &lt;-accident <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(state_name <span class="op">==</span><span class="st"> </span>which_state) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">drunk_dr =</span> <span class="kw">factor</span>(drunk_dr, <span class="dt">labels =</span> 
                               <span class="kw">c</span>(<span class="st">&quot;Unrelated to</span><span class="ch">\n</span><span class="st">drunk driving&quot;</span>,
                                 <span class="st">&quot;Related to</span><span class="ch">\n</span><span class="st">drunk driving&quot;</span>)),
           <span class="dt">daytime =</span> <span class="kw">factor</span>(daytime, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Nighttime&quot;</span>, <span class="st">&quot;Daytime&quot;</span>))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(daytime, month, drunk_dr) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">accidents =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> daytime, <span class="dt">y =</span> accidents, <span class="dt">group =</span> daytime)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>drunk_dr, <span class="dt">ncol =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Time of day&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;# of monthly accidents&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Fatal accidents in&quot;</span>, which_state, <span class="st">&quot;in 2015&quot;</span>))
  <span class="kw">print</span>(a)
}
<span class="kw">dev.off</span>()</code></pre></div>
</div>
</div>
<div id="using-regression-models-to-explore-data" class="section level3">
<h3><span class="header-section-number">7.6.3</span> Using regression models to explore data</h3>
<p>For this part of the exercise, you’ll use a dataset on weather, air pollution, and mortality counts in Chicago, IL. This dataset is called <code>chicagoNMMAPS</code> and is part of the <code>dlnm</code> package. Change the name of the dataframe to something shorter, like <code>chic</code>. Check out the data a bit to see what variables you have, and then perform the following tasks:</p>
<ul>
<li>Write out (on paper, not in R) the regression equation for regressing dewpoint temperature on temperature.</li>
<li>Try fitting a linear regression of dew point temperature (<code>dptp</code>) on temperature (<code>temp</code>). (Bonus points: Notice anything that seems unusual about these two variables in this dataset? You can find out with <code>summary</code>, but it helps if you know a bit about what dewpoint temperature measures.) Save this model as the object <code>mod_1</code>.</li>
<li>Based on this regression, does there seem to be a relationship between temperature and dewpoint temperature in Chicago? (Hint: Try using <code>summary()</code> on the model object to get more information about the model you fit.) What is the p-value for the coefficient for temperature?</li>
<li>Plot temperature (x-axis) versus dewpoint temperature (y-axis) for Chicago. Add in the regression line from the model you fit.</li>
<li>Use <code>plot()</code> on the model object to check if some of the assumptions for the regression model seem appropriate.</li>
<li>Try fitting the regression as a GLM, using <code>glm()</code>. Are your coefficients different?</li>
<li>Does <span class="math inline">\(PM_{10}\)</span> vary by day of the week? (Hint: The <code>dow</code> variable is a factor that gives day of the week. You can do an ANOVA analysis by fitting a linear model using this variable as the independent variable, and then run <code>anova()</code> on that model, and R will compare it to an intercept-only model.) What day of the week is PM10 generally highest? (Check the model coefficients to figure this out.) Try to write out (on paper) the regression equation for the model you’re fitting.</li>
<li>Try using <code>glm()</code> to run a Poisson regression of respiratory deaths (<code>resp</code>) on temperature during summer days. Start by creating a subset with just summer days called <code>summer</code>. (Hint: Use the <code>month</code> variable to do this– just pull out the subset where the month is 6, 7, or 8, for June, July, and August.) Try to write out the regression equation for the model you’re fitting.</li>
<li>The coefficient for the temperature variable in this model is our best estimate (based on this model) of the <strong>log relative risk</strong> for a one degree Celcius increase in temperature. What is the <strong>relative risk</strong> associated with a one degree Celsius increase?</li>
</ul>
<div id="example-r-code-14" class="section level4">
<h4><span class="header-section-number">7.6.3.1</span> Example R code:</h4>
<p>Install and load the <code>dlnm</code> package and then load the <code>chicagoNMMAPS</code> data. Change the name of the dataframe to <code>chic</code>, so it will be shorter to call for the rest of your work.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages(&quot;dlnm&quot;)</span>
<span class="kw">library</span>(dlnm)
<span class="kw">data</span>(<span class="st">&quot;chicagoNMMAPS&quot;</span>)
chic &lt;-<span class="st"> </span>chicagoNMMAPS</code></pre></div>
<p>Fit a linear regression of <code>dptp</code> on <code>temp</code> and save as the object <code>mod_1</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(dptp <span class="op">~</span><span class="st"> </span>temp, <span class="dt">data =</span> chic)
mod_<span class="dv">1</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = dptp ~ temp, data = chic)
## 
## Coefficients:
## (Intercept)         temp  
##      24.025        1.621</code></pre>
<p>Use <code>summary()</code> to check out a bit more about the model you fit.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(mod_<span class="dv">1</span>)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = dptp ~ temp, data = chic)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -24.3093  -3.7470   0.4687   4.0738  18.6518 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 24.024869   0.112933   212.7   &lt;2e-16 ***
## temp         1.620650   0.007631   212.4   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 5.899 on 5112 degrees of freedom
## Multiple R-squared:  0.8982, Adjusted R-squared:  0.8982 
## F-statistic: 4.511e+04 on 1 and 5112 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>There does seem to be an association between temperature and dewpoint temperature: a unit increase in temperature is associated with a 1.6 unit increase in dewpoint temperature. The p-value for the temperature coefficient is &lt;2e-16. This is far below 0.05, which suggests we would be very unlikely to see such a strong association by chance if the null hypothesis, that the two variables are not associated, were true.</p>
<p>Plot these two variables and add in the regression line from the model (note: I’ve used the <code>color</code> option to make the color of the points gray). Use the values from <code>coef</code> with a <code>geom_abline</code> to add the regression line for the model you fit.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod_coefs &lt;-<span class="st"> </span><span class="kw">coef</span>(mod_<span class="dv">1</span>)
<span class="kw">ggplot</span>(chic, <span class="kw">aes</span>(<span class="dt">x =</span> temp, <span class="dt">y =</span> dptp)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">0.5</span>, <span class="dt">col =</span> <span class="st">&quot;gray&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_abline</span>(<span class="kw">aes</span>(<span class="dt">intercept =</span> mod_coefs[<span class="dv">1</span>], <span class="dt">slope =</span> mod_coefs[<span class="dv">2</span>]))</code></pre></div>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-436-1.png" width="672" /></p>
<p>Plot some plots to check model assumptions for the model you fit using the <code>plot()</code> function on your model object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>)) <span class="co"># Set to four plots per panel -- 2 rows, 2 columns</span>
<span class="kw">plot</span>(mod_<span class="dv">1</span>)</code></pre></div>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-437-1.png" width="576" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>)) <span class="co"># Reset to one plot per panel</span></code></pre></div>
<p>Try fitting the model using <code>glm()</code>. Call it <code>mod_1a</code>. Compare the coefficients for the two models. You can use the <code>coef()</code> function on an <code>lm</code> or <code>glm</code> object to pull out just the model coefficients.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod_1a &lt;-<span class="st"> </span><span class="kw">glm</span>(dptp <span class="op">~</span><span class="st"> </span>temp, <span class="dt">data =</span> chic)

<span class="kw">coef</span>(mod_<span class="dv">1</span>)</code></pre></div>
<pre><code>## (Intercept)        temp 
##    24.02487     1.62065</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coef</span>(mod_1a)</code></pre></div>
<pre><code>## (Intercept)        temp 
##    24.02487     1.62065</code></pre>
<p>The results from the two models are identical.</p>
<p>Fit a model of <span class="math inline">\(PM_{10}\)</span> regressed on day of week, where day of week is a factor.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(pm10 <span class="op">~</span><span class="st"> </span>dow, <span class="dt">data =</span> chic)
<span class="kw">summary</span>(mod_<span class="dv">2</span>)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = pm10 ~ dow, data = chic)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -39.05 -12.55  -3.34   8.80 328.66 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   27.5217     0.7303  37.684  &lt; 2e-16 ***
## dowMonday      6.1322     1.0340   5.931 3.22e-09 ***
## dowTuesday     6.7954     1.0269   6.617 4.05e-11 ***
## dowWednesday   8.4768     1.0262   8.261  &lt; 2e-16 ***
## dowThursday    8.8047     1.0240   8.598  &lt; 2e-16 ***
## dowFriday      9.4816     1.0262   9.240  &lt; 2e-16 ***
## dowSaturday    3.6602     1.0269   3.564 0.000368 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 19.07 on 4856 degrees of freedom
##   (251 observations deleted due to missingness)
## Multiple R-squared:  0.02588,    Adjusted R-squared:  0.02467 
## F-statistic:  21.5 on 6 and 4856 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Use the <code>anova()</code> command to compare this model to a model with only an intercept (i.e., one that only fits a global mean and uses that as the expected value for all of the observations).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anova</span>(mod_<span class="dv">2</span>)</code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: pm10
##             Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
## dow          6   46924  7820.6    21.5 &lt; 2.2e-16 ***
## Residuals 4856 1766407   363.8                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The p-value for an ANOVA of the model with day-of-week coefficients versus the model that just has an intercept is &lt; 2.2e-16. This is well below 0.05, which suggests that day-of-week is associated with PM10 concentration, as a model that includes day-of-week does a much better job of explaining variation in PM10 than a model without it does. (Note, too, that the F value and Pr(&gt;F) for the <code>anova()</code> call are identical to the F-statistic information given in the <code>summary()</code> of the model object. This will always be true when you’re using <code>anova()</code> to compare a model to a model with just an intercept.)</p>
<p>Use a boxplot to visually compare PM10 by day of week.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(chic, <span class="kw">aes</span>(<span class="dt">x =</span> dow, <span class="dt">y =</span> pm10)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_boxplot</span>()</code></pre></div>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-441-1.png" width="576" /></p>
<p>Now try the same plot, but try using the <code>ylim =</code> option to change the limits on the y-axis for the graph, so you can get a better idea of the pattern by day of week (some of the extreme values are very high, which makes it hard to compare by eye when the y-axis extends to include them all).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(chic, <span class="kw">aes</span>(<span class="dt">x =</span> dow, <span class="dt">y =</span> pm10)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">100</span>))</code></pre></div>
<pre><code>## Warning: Removed 292 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="RProgrammingForResearch_files/figure-html/unnamed-chunk-442-1.png" width="576" /></p>
<p>Create a subset called <code>summer</code> with just the summer days:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">summer &lt;-<span class="st"> </span>chic <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(month <span class="op">%in%</span><span class="st"> </span><span class="dv">6</span><span class="op">:</span><span class="dv">8</span>)</code></pre></div>
<p>Use <code>glm()</code> to fit a Poisson model of respiratory deaths regressed on temperature. Since you want to fit a Poisson model, use the option <code>family = poisson(link = &quot;log&quot;)</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">glm</span>(resp <span class="op">~</span><span class="st"> </span>temp, <span class="dt">data =</span> summer,
             <span class="dt">family =</span> <span class="kw">poisson</span>(<span class="dt">link =</span> <span class="st">&quot;log&quot;</span>))
<span class="kw">summary</span>(mod_<span class="dv">3</span>)</code></pre></div>
<pre><code>## 
## Call:
## glm(formula = resp ~ temp, family = poisson(link = &quot;log&quot;), data = summer)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -3.9755  -0.7162  -0.1807   0.6927   3.6555  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) 1.910317   0.058373  32.726   &lt;2e-16 ***
## temp        0.006137   0.002581   2.378   0.0174 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 1499.4  on 1287  degrees of freedom
## Residual deviance: 1493.8  on 1286  degrees of freedom
## AIC: 6425.4
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>Use the fitted model coefficient to determine the relative risk for a one degree Celcius increase in temperature. First, remember that you can use the <code>coef()</code> function to read out the model coefficients. The second of these is the value for the temperature coefficient. That means that you can use indexing (<code>[2]</code>) to get just that value. That’s the log relative risk; take the exponent to get the relative risk.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coef</span>(mod_<span class="dv">3</span>)</code></pre></div>
<pre><code>## (Intercept)        temp 
## 1.910316958 0.006136743</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coef</span>(mod_<span class="dv">3</span>)[<span class="dv">2</span>]</code></pre></div>
<pre><code>##        temp 
## 0.006136743</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">exp</span>(<span class="kw">coef</span>(mod_<span class="dv">3</span>)[<span class="dv">2</span>])</code></pre></div>
<pre><code>##     temp 
## 1.006156</code></pre>

</div>
</div>
</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="entering-and-cleaning-data-2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="appendix-a-vocabulary.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/geanders/RProgrammingForResearch/edit/master/07-exploringdata2.Rmd",
"text": "Edit"
},
"download": ["RProgrammingForResearch.pdf", "RProgrammingForResearch.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
